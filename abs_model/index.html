<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Highcharts Example</title>

    <link rel="stylesheet" href="static/jquery-ui-1.12.1.css">
    <script type="text/javascript" src="static/jquery-1.11.3.js"></script>
    <script type="text/javascript" src="static/jquery-ui-1.12.1.js"></script>

    <script type="text/javascript" src="static/highcharts.js"></script>
    <script type="text/javascript" src="static/modules/exporting.js"></script>


  </head>
  <!--
	<body>
    <div id="tabs">
      <ul>
				<li><a href="#per-component">Components</a></li>
				<li><a href="#common">Caas</a></li>
        <!-- <li><a href="#per-component">Components</a></li> 
      </ul>
       <div id="common">
        <div id="times-est" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
        <div id="times-act" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
      </div> 
      <div id="per-component">
      </div>
    </div>
  </body>-->
    <script type="text/javascript">

function to_highchart_date(startdate, offset) {
    return startdate + (offset * 60 * 1000);
}

function build_component_plot(container_id,name,history) {
    if (history.length > 0) {
        new_container_id = 'c' + container_id;
        //$(container_id).append('<h3>' + name + '</h3>');
        $(container_id).append('<div id="' + new_container_id + '" style="min-width: 310px; min-height: 400px; height: 400px; margin: 0 auto"></div>');

        var series = [];
				series.push({
						name: 'Latency',
						turboThreshold: 0,
				    data: history.map( function(item,index) {
				                         return {
				                             x: to_highchart_date(0, index),
				                             y: item
				                             //name: 'aa'//item.trdT
				                         };
				                     })});
				Highcharts.chart(new_container_id, {
				    chart: {
				        type: 'line',
				        zoomType: 'x'
				    },
				    title: {
				        text: name
				    },
				    subtitle: {
				        text: 'Latency plot'
				    },
				    xAxis: {
				        type: 'datetime',
				        dateTimeLabelFormats: {
				            month: '%e. %b',
				            year: '%b'
				        },
				        title: {
				            text: 'Time'
				        }
				    },
				    yAxis: {
				        title: {
				            text: 'Latency (ms)'
				        },
				        min: 0
				    },
				    tooltip: {
				        xDateFormat: '%Y-%m-%d',
				        headerFormat: '<b>{series.name}</b><br>',
				        pointFormat: '<b>{point.y:.2f}t</b> {point.name} at {point.x:%H:%m}'
				    },
				    plotOptions: {
				        line: {
				            marker: {
				                enabled: true
				            }
				        }
				    },
				    series: series
				});

    }
}


function printInConsole(obj, str = ""){
		var output = str;
		for (property in obj) {
    		output += property + ': ' + obj[property]+'; ';
		}
		console.log(output);
}

function loadJSON(){
		// get the data for all the components
		$.getJSON("/o")
				.done(function(comp_list) {
						comp_list.forEach( function(item) {
								$.getJSON("/o/" + item).done( function(result) {
										var tabs = $("#tabs").tabs();
										var ul = tabs.find("ul");
										$('<li><a href="#' + item + '">' + result['name'] + '</a></li>').appendTo(ul);
										tabs.append('<div id="' + item + '"> </div>');
										tabs.tabs("refresh");

										/*$("#tabs ul:first" ).append(
											$('<li>').append(
        								$('<a>').attr('href','#'+item).append(result['name'])));
										console.log($("#tabs ul:first" ).text());
										$("#tabs" ).append(
											$('<div>').attr('id',item)); */
										build_component_plot('#'+item, result['name'], result['measure_list']) 
										//printInConsole(data,"step "); 
								});
						});
				});
}

/*
    $.getJSON("/o/Component1/measure_list")
			.done(function(data) {
		      var history = data['measure_list'];	
					build_component_plot('comp1',history);
		  })
			.fail(function() {
					$('#per-component').append('<p> JSON Query Error </p>');
			}); */

$(document).ready(function(){
		loadJSON();
		tabs.tabs( { 'active': 0} )
});
  </script>

	<body>
    <div id="tabs">
      <ul>
      </ul>
    </div>
  </body>

</html>
